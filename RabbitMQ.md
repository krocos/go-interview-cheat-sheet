# Основные концепции RabbitMQ
## Компоненты системы
- **Producer** (издатель) — отправляет сообщения.
- **Consumer** (потребитель) — получает сообщения.
- **Exchange** (обменник) — принимает сообщения и решает, в какие очереди их направить.
- **Queue** (очередь) — хранит сообщения до обработки.
- **Binding** (привязка) — связь между exchange и queue с определёнными правилами.
## Типы Exchange
- **Direct** — сообщения идут в очередь с точным совпадением `routing_key`.
- **Fanout** — рассылка во все связанные очереди (broadcast).
- **Topic** — маршрутизация по шаблону (`user.*.orders`).
- **Headers** — маршрутизация по заголовкам (а не по `routing_key`).
# Особенности работы с очередями
## Durability (сохранение сообщений)
- **Durable queue** — переживает перезапуск брокера (`durable=true`).
- **Transient queue** — удаляется при перезапуске (`durable=false`).
## Exclusive очереди
- Создаётся для одного соединения и удаляется при его закрытии (`exclusive=true`). Полезно для временных очередей.
## TTL (Time-To-Live)
- **TTL сообщения**: `expiration` в заголовках.
- **TTL очереди**: `x-message-ttl` в аргументах.
# Гарантии доставки
## Подтверждения (Acknowledgements)
- **Manual Ack** — потребитель явно подтверждает обработку (autoAck=false).
- **Nack** — сообщение можно отвергнуть (requeue или отбросить).
## Publisher Confirms
- Подтверждение, что сообщение записано на диск брокера
# Dead Letter Exchange (DLX)
- Очередь для "мертвых" сообщений (недоставленных или отвергнутых).
- Настраивается через аргументы очереди:
```go
args := amqp.Table{
    "x-dead-letter-exchange": "dlx_orders",
}
ch.QueueDeclare("orders", true, false, false, false, args)
```
# Prefetch Count
Лимит неподтверждённых сообщений для одного consumer (избегает перегрузки):
```go
ch.Qos(10, 0, false) // Не более 10 сообщений в работе
```
# Кластеры и HA (High Availability)
- **Кластер RabbitMQ** — несколько нод, синхронизирующих состояние (но не сообщения!).
- **Mirrored Queues** — репликация очередей между нодами для отказоустойчивости.
- **Политики (Policies)** — автоматическое зеркалирование через `x-ha-policy`.
