На собеседовании, говоря о транзакциях в PostgreSQL, важно раскрыть их ключевые свойства, особенности реализации и практическое применение. Вот основные темы, которые стоит затронуть:  
# Основные свойства транзакций (ACID)  
PostgreSQL строго следует принципам ACID:  
- **Atomicity (Атомарность)** – транзакция выполняется целиком или не выполняется вообще.  
- **Consistency (Согласованность)** – транзакция переводит БД из одного валидного состояния в другое.  
- **Isolation (Изолированность)** – параллельные транзакции не влияют друг на друга.  
- **Durability (Долговечность)** – после фиксации (COMMIT) изменения сохраняются даже при сбое.  
# Уровни изоляции транзакций  
PostgreSQL поддерживает стандартные уровни изоляции (с некоторыми особенностями): 
1. **Read Uncommitted** – формально есть, но работает как **Read Committed** (в PG нет "грязного чтения").  
2. **Read Committed (по умолчанию)** – транзакция видит только закоммиченные данные других транзакций.  
3. **Repeatable Read** – гарантирует, что данные, прочитанные в транзакции, не изменятся до её завершения (но возможны аномалии "фантомного чтения").  
4. **Serializable** – строгая изоляция, гарантирует полную последовательную выполнимость (как если бы транзакции выполнялись одна за другой).  

**Важно:** В PostgreSQL `Repeatable Read` не допускает фантомного чтения благодаря системе управления версиями данных (MVCC).  
# Управление транзакциями  
- **Начало:** `BEGIN` или `START TRANSACTION`  
- **Фиксация:** `COMMIT`  
- **Откат:** `ROLLBACK`  
- **Точки сохранения (Savepoints):**  
  ```sql
  SAVEPOINT my_savepoint;
  -- ... операции ...
  ROLLBACK TO my_savepoint;  -- откат к точке
  RELEASE my_savepoint;      -- удаление точки
  ```
# Конфликты и блокировки  
- **Блокировки:** PostgreSQL использует механизм блокировок (row-level, table-level) для управления конкурентным доступом.  
- **Deadlock (взаимная блокировка):**  
  PostgreSQL автоматически обнаруживает deadlock и откатывает одну из транзакций.  
- **Оптимистичные и пессимистичные стратегии:**  
  - Пессимистичные: `SELECT FOR UPDATE`, `SELECT FOR SHARE`.  
  - Оптимистичные: проверка версий данных перед коммитом.  
# Особенности MVCC (Multiversion Concurrency Control)  
PostgreSQL использует MVCC для изоляции транзакций:  
- Каждая транзакция видит "снимок" (snapshot) данных на момент своего начала.  
- Данные не перезаписываются, а создаются новые версии строк.  
- Старые версии очищаются `VACUUM` (автоочистка или ручная).  
# Двухфазный коммит (2PC)  
- Поддержка распределённых транзакций:  
  ```sql
  BEGIN;
  -- операции...
  PREPARE TRANSACTION 'tx_name';  -- подготовка
  COMMIT PREPARED 'tx_name';      -- фиксация
  ```  
- Полезно для распределённых систем.  
# Практические советы
- **Короткие транзакции** – уменьшают конфликты.  
- **Избегание долгих операций в транзакциях** – снижает риск deadlock.  
- **Настройка `idle_in_transaction_session_timeout`** – убивает "зависшие" транзакции.  
 